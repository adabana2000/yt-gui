# YouTube Downloader テストチェックリスト

## 🎯 テスト実施ガイド

このチェックリストは、実装した全10機能が正しく動作することを確認するためのものです。
各項目をテストして、動作確認できたらチェック ✅ を入れてください。

---

## 📋 事前準備

### 環境準備
- [ ] Python 3.10以上がインストールされている
- [ ] 依存パッケージがインストールされている (`pip install -r requirements.txt`)
- [ ] データベースが初期化されている
- [ ] `downloads/`, `data/`, `logs/` ディレクトリが存在する

### 起動確認
- [ ] GUIモードで起動できる (`python main.py --mode gui`)
- [ ] エラーなく起動し、メインウィンドウが表示される
- [ ] 設定タブが7つのサブタブに分かれて表示される

---

## 🧪 機能別テスト

### 1️⃣ 画質/フォーマット選択

#### GUI操作テスト
- [ ] 設定タブ → 「画質/フォーマット」タブを開く
- [ ] 画質プリセットドロップダウンに9つの選択肢が表示される
  - [ ] 最高画質 (best)
  - [ ] 4K 2160p
  - [ ] 2K 1440p
  - [ ] Full HD 1080p
  - [ ] HD 720p
  - [ ] SD 480p
  - [ ] 低画質 360p
  - [ ] 最低画質 (worst)
  - [ ] 音声のみ (audio only)
- [ ] 動画フォーマットを変更できる (MP4/WebM/MKV/Any)
- [ ] 音声品質を選択できる (best/320k/256k/192k/128k/worst)
- [ ] 音声フォーマットを選択できる (M4A/MP3/Opus/WAV/Best)
- [ ] GPU設定が表示される
- [ ] 「設定を保存」をクリックして保存できる

#### 動作テスト
- [ ] 「Full HD 1080p」を選択して保存
- [ ] テスト動画をダウンロード
- [ ] ダウンロードされた動画が1080p以下の解像度である
- [ ] ログファイルで使用されたフォーマット文字列を確認
  ```bash
  tail -f logs/youtube_downloader.log
  ```
- [ ] フォーマット文字列に `height<=1080` が含まれている

#### 音声のみテスト
- [ ] 「音声のみ (audio only)」を選択して保存
- [ ] テスト動画をダウンロード
- [ ] 音声ファイルのみがダウンロードされる (動画なし)
- [ ] ファイル拡張子が音声フォーマット (m4a/mp3など) である

**結果:** ✅ / ❌

---

### 2️⃣ 字幕ダウンロード

#### GUI操作テスト
- [ ] 設定タブ → 「字幕」タブを開く
- [ ] 「字幕をダウンロード」チェックボックスがある
- [ ] 「自動生成字幕もダウンロード」チェックボックスがある
- [ ] 字幕言語入力欄がある (例: ja, en, ko)
- [ ] 字幕フォーマット選択がある (SRT/VTT/ASS/Best)
- [ ] 「字幕を動画ファイルに埋め込む」チェックボックスがある
- [ ] 将来機能セクション(グレーアウト)が表示される

#### 動作テスト（別ファイル保存）
- [ ] 「字幕をダウンロード」にチェック
- [ ] 字幕言語を「ja, en」に設定
- [ ] 「字幕を動画ファイルに埋め込む」のチェックを**外す**
- [ ] 設定を保存
- [ ] 字幕付き動画をダウンロード
- [ ] `.ja.srt` ファイルが生成される
- [ ] `.en.srt` ファイルが生成される（英語字幕がある場合）
- [ ] 字幕ファイルをテキストエディタで開いて内容を確認

#### 動作テスト（埋め込み）
- [ ] 「字幕を動画ファイルに埋め込む」にチェック
- [ ] 設定を保存
- [ ] 字幕付き動画をダウンロード
- [ ] 別ファイルとして字幕が保存されない
- [ ] VLCなどのプレーヤーで動画を開き、字幕トラックが埋め込まれていることを確認

**結果:** ✅ / ❌

---

### 3️⃣ 通知機能

#### デスクトップ通知テスト
- [ ] 設定タブ → 「通知」タブを開く
- [ ] 「通知を有効にする」にチェック
- [ ] 「デスクトップ通知を表示」にチェック
- [ ] 「通知音を鳴らす」にチェック
- [ ] 「ダウンロード完了時」にチェック
- [ ] 「通知をテスト」ボタンをクリック
- [ ] システムトレイにテスト通知が表示される
- [ ] 通知音が鳴る（設定している場合）

#### ダウンロード完了通知テスト
- [ ] 上記設定を保存
- [ ] 短い動画をダウンロード
- [ ] ダウンロード完了時にデスクトップ通知が表示される
- [ ] 通知に動画タイトルとチャンネル名が含まれる
- [ ] 通知音が鳴る

#### エラー通知テスト
- [ ] 「エラー発生時」にチェック
- [ ] 設定を保存
- [ ] 存在しないURLでダウンロードを試みる
- [ ] エラー通知が表示される

#### メール通知テスト（オプション）
- [ ] 「メール通知を有効にする」にチェック
- [ ] SMTPサーバー設定を入力
  - サーバー: `smtp.gmail.com` (Gmailの場合)
  - ポート: `587`
  - TLS: チェック
  - ユーザー名: メールアドレス
  - パスワード: アプリパスワード
  - 送信元: メールアドレス
  - 送信先: メールアドレス
- [ ] 設定を保存
- [ ] 動画をダウンロード
- [ ] 完了時にHTMLメールが届く
- [ ] メールに動画情報（タイトル、チャンネル、ID、保存先）が含まれる

**結果:** ✅ / ❌

---

### 4️⃣ プレイリスト一括ダウンロード

#### GUI操作テスト
- [ ] 設定タブ → 「プレイリスト」タブを開く
- [ ] 「プレイリスト全体をダウンロード」チェックボックスがある
- [ ] 範囲設定（開始/終了）ができる
- [ ] 個別指定入力欄がある
- [ ] 最大ダウンロード数設定がある
- [ ] アーカイブ設定セクションがある
- [ ] フィルター設定（日付、再生回数、動画長）がある

#### 範囲指定テスト
- [ ] 「プレイリスト全体をダウンロード」にチェック
- [ ] 開始: 1、終了: 3 に設定
- [ ] 設定を保存
- [ ] テスト用プレイリストURLを入力してダウンロード
- [ ] 最初の3本だけがダウンロードされる
- [ ] `data/download_archive.txt` に3つのIDが記録される

#### 個別指定テスト
- [ ] 個別指定欄に「1,3,5」を入力
- [ ] 設定を保存
- [ ] プレイリストをダウンロード
- [ ] 1番目、3番目、5番目の動画のみがダウンロードされる

#### アーカイブテスト
- [ ] 「ダウンロード済みを記録」にチェック
- [ ] 設定を保存
- [ ] プレイリストを1回ダウンロード
- [ ] `data/download_archive.txt` を確認し、IDが記録されている
- [ ] 同じプレイリストを再度ダウンロード
- [ ] 既にダウンロード済みの動画がスキップされる
- [ ] ログに「Skipping duplicate」メッセージが表示される

#### フィルターテスト
- [ ] 日付範囲フィルターを設定（例: 20240101-20241231）
- [ ] 再生回数フィルターを設定（例: 最小10000）
- [ ] 設定を保存
- [ ] プレイリストをダウンロード
- [ ] 条件に合う動画のみがダウンロードされる

**結果:** ✅ / ❌

---

### 5️⃣ 重複チェック

#### GUI操作テスト
- [ ] 設定タブ → 「ダウンロード」タブを開く
- [ ] 「重複をスキップする」チェックボックスがある
- [ ] 「動画IDでチェック」チェックボックスがある
- [ ] 「ファイル名でチェック」チェックボックスがある

#### 動画ID重複チェック
- [ ] すべての重複チェックにチェック
- [ ] 設定を保存
- [ ] テスト動画をダウンロード
- [ ] 同じURLで再度ダウンロードを試みる
- [ ] ログに重複メッセージが表示される
- [ ] ダウンロードがスキップされる
- [ ] データベースで確認:
  ```bash
  sqlite3 data/youtube_downloader.db
  SELECT id, title FROM download_history;
  .exit
  ```
- [ ] 1件のみ記録されている

#### ファイル名重複チェック
- [ ] ダウンロード済みの動画ファイルを確認
- [ ] ファイル名を変更せずに同じ動画をダウンロード
- [ ] ファイルが既に存在するため、重複としてスキップされる

#### アーカイブ重複チェック
- [ ] `data/download_archive.txt` を確認
- [ ] アーカイブに記録されている動画IDをダウンロード
- [ ] アーカイブチェックによりスキップされる
- [ ] ログに「Skipping duplicate (archive): video_id」が表示される

**結果:** ✅ / ❌

---

### 6️⃣ サムネイルダウンロード

#### GUI操作テスト
- [ ] 設定タブ → 「ダウンロード」タブを開く
- [ ] 「サムネイルをダウンロード」チェックボックスがある
- [ ] 「サムネイルを動画に埋め込む」チェックボックスがある

#### 別ファイル保存テスト
- [ ] 「サムネイルをダウンロード」にチェック
- [ ] 「サムネイルを動画に埋め込む」のチェックを**外す**
- [ ] 設定を保存
- [ ] 動画をダウンロード
- [ ] `.jpg` または `.webp` サムネイルファイルが生成される
- [ ] 画像ビューアーで開いて確認

#### 埋め込みテスト
- [ ] 「サムネイルを動画に埋め込む」にチェック
- [ ] 設定を保存
- [ ] 動画をダウンロード
- [ ] VLCやMPVで動画を開く
- [ ] プレイヤーでサムネイルが表示されることを確認
- [ ] （または）メディア情報でサムネイルが埋め込まれていることを確認

**結果:** ✅ / ❌

---

### 7️⃣ ダウンロード速度制限

#### GUI操作テスト
- [ ] 設定タブ → 「詳細設定」タブを開く
- [ ] 「ダウンロード速度を制限する」チェックボックスがある
- [ ] 最大速度スピンボックスがある (KB/s単位)
- [ ] 説明文「1024 KB/s = 1 MB/s」が表示される

#### 速度制限テスト
- [ ] 「ダウンロード速度を制限する」にチェック
- [ ] 最大速度を 512 KB/s に設定
- [ ] 設定を保存
- [ ] 大きめの動画（50MB以上）をダウンロード開始
- [ ] ダウンロード中、ダウンロードタブで速度を確認
- [ ] 速度が約 512 KB/s (0.5 MB/s) 前後に制限されている
- [ ] ログファイルでレート制限が適用されていることを確認

#### 制限なしテスト
- [ ] 「ダウンロード速度を制限する」のチェックを外す
- [ ] 設定を保存
- [ ] 同じ動画を再度ダウンロード
- [ ] 最大速度でダウンロードされる（制限なし）

**結果:** ✅ / ❌

---

### 8️⃣ yt-dlp自動アップデート

#### GUI操作テスト
- [ ] 設定タブ → 「詳細設定」タブを開く
- [ ] 「yt-dlpを自動アップデート」チェックボックスがある
- [ ] 「起動時に更新をチェック」チェックボックスがある
- [ ] 更新チェック間隔設定がある (日数)
- [ ] 状態ラベルが表示される
- [ ] 「今すぐ更新をチェック」ボタンがある

#### バージョン確認テスト
- [ ] ターミナルで現在のバージョンを確認:
  ```bash
  python -m yt_dlp --version
  ```
- [ ] バージョン番号をメモ

#### 手動更新チェックテスト
- [ ] 「今すぐ更新をチェック」ボタンをクリック
- [ ] 状態ラベルが「確認中...」に変わる
- [ ] 更新結果がダイアログで表示される
  - 最新版の場合: 「最新版です (バージョン番号)」
  - 更新がある場合: 「更新完了: 旧バージョン -> 新バージョン」

#### 自動更新設定テスト
- [ ] 「yt-dlpを自動アップデート」にチェック
- [ ] 「起動時に更新をチェック」にチェック
- [ ] 更新チェック間隔を 7日 に設定
- [ ] 設定を保存
- [ ] アプリを再起動
- [ ] 起動時に自動的に更新チェックが実行される（ログ確認）

#### CLIテスト
- [ ] ターミナルで直接テスト:
  ```bash
  python -c "
  import asyncio
  from core.service_manager import ServiceConfig
  from database.db_manager import DatabaseManager
  from modules.updater_manager import UpdaterManager

  async def test():
      config = ServiceConfig()
      db = DatabaseManager()
      updater = UpdaterManager(config, db)
      await updater.start()

      version = await updater.get_current_version()
      print(f'Current version: {version}')

      info = await updater.get_system_info()
      for k, v in info.items():
          print(f'{k}: {v}')

      await updater.stop()

  asyncio.run(test())
  "
  ```
- [ ] yt-dlpバージョン、Python バージョン、システム情報が表示される

**結果:** ✅ / ❌

---

### 9️⃣ プロキシ設定

#### GUI操作テスト
- [ ] 設定タブ → 「詳細設定」タブを開く
- [ ] 「プロキシを使用する」チェックボックスがある
- [ ] プロキシタイプ選択がある (HTTP/HTTPS/SOCKS5)
- [ ] HTTPプロキシ入力欄がある
- [ ] HTTPSプロキシ入力欄がある
- [ ] SOCKSプロキシ入力欄がある
- [ ] 認証セクション（ユーザー名/パスワード）がある

#### 設定テスト（プロキシサーバーがある場合のみ）
- [ ] 「プロキシを使用する」にチェック
- [ ] プロキシタイプを選択
- [ ] プロキシURLを入力 (例: `http://proxy.example.com:8080`)
- [ ] 必要に応じて認証情報を入力
- [ ] 設定を保存
- [ ] 動画をダウンロード
- [ ] ログでプロキシ経由でのアクセスが確認できる

#### 設定保存確認
- [ ] プロキシ設定を入力
- [ ] 設定を保存
- [ ] アプリを再起動
- [ ] 設定タブを開く
- [ ] 入力したプロキシ設定が保持されている

**結果:** ✅ / ❌ / ⏭️ (スキップ)

---

### 🔟 ダウンロード履歴管理

#### GUI確認テスト
- [ ] 「履歴」タブを開く
- [ ] ダウンロード済み動画のリストが表示される
- [ ] 各エントリに以下が表示される:
  - 動画タイトル
  - チャンネル名
  - ダウンロード日時
  - ファイルパス

#### 検索機能テスト
- [ ] 履歴タブの検索欄にキーワードを入力
- [ ] リストが検索結果でフィルタリングされる
- [ ] タイトルまたは説明に含まれる動画のみ表示される

#### データベース確認テスト
- [ ] ターミナルでデータベースを確認:
  ```bash
  sqlite3 data/youtube_downloader.db
  SELECT COUNT(*) FROM download_history;
  SELECT id, title, channel_name, download_date FROM download_history ORDER BY download_date DESC LIMIT 5;
  .exit
  ```
- [ ] ダウンロード件数が表示される
- [ ] 最新5件の履歴が表示される
- [ ] GUIの履歴と一致している

#### 統計確認テスト
- [ ] 統計情報を確認:
  ```bash
  sqlite3 data/youtube_downloader.db
  SELECT
    COUNT(*) as total_downloads,
    SUM(file_size) as total_size,
    SUM(duration) as total_duration
  FROM download_history;
  .exit
  ```
- [ ] 総ダウンロード数、合計サイズ、合計時間が表示される

**結果:** ✅ / ❌

---

## 🎨 GUI全体テスト

### レイアウト確認
- [ ] すべてのタブが正しく表示される
- [ ] タブ間の切り替えがスムーズ
- [ ] ウィンドウサイズを変更しても正しく表示される
- [ ] すべてのボタンがクリック可能
- [ ] すべての入力欄が入力可能

### 設定の永続化
- [ ] 各タブで設定を変更
- [ ] 「設定を保存」をクリック
- [ ] 成功メッセージが表示される
- [ ] アプリを再起動
- [ ] すべての設定が保持されている

### エラーハンドリング
- [ ] 無効なURLを入力してダウンロード
- [ ] エラーメッセージが表示される
- [ ] アプリがクラッシュしない
- [ ] エラーがログに記録される

---

## 🔗 統合テスト

### すべての機能を有効化
- [ ] 以下の設定を同時に有効化:
  - 画質: 1080p
  - 字幕: ja, en
  - サムネイル: ダウンロード
  - 通知: デスクトップ通知
  - 速度制限: 1024 KB/s
  - アーカイブ: 有効
  - 重複チェック: すべて有効
- [ ] 設定を保存

### 統合ダウンロードテスト
- [ ] 字幕付き動画をダウンロード
- [ ] ダウンロード開始
- [ ] 以下を確認:
  - [ ] 1080p品質でダウンロード
  - [ ] 字幕ファイル (`.ja.srt`, `.en.srt`) が生成される
  - [ ] サムネイル (`.jpg`) が生成される
  - [ ] ダウンロード速度が約1MB/s以下
  - [ ] 完了時にデスクトップ通知が表示される
  - [ ] `download_archive.txt` に記録される
  - [ ] データベースに履歴が保存される
- [ ] 同じ動画を再度ダウンロード
  - [ ] 重複としてスキップされる

**結果:** ✅ / ❌

---

## 📊 ログ確認

### ログファイルの確認
- [ ] `logs/youtube_downloader.log` を開く
- [ ] 以下のログエントリが記録されている:
  - [ ] サービス起動ログ
  - [ ] ダウンロード開始ログ
  - [ ] フォーマット選択ログ
  - [ ] ダウンロード進捗ログ
  - [ ] 完了ログ
  - [ ] 通知送信ログ
  - [ ] 設定保存ログ
- [ ] エラーログがないこと（正常動作の場合）

### アーカイブファイルの確認
- [ ] `data/download_archive.txt` を開く
- [ ] ダウンロードした動画のIDが記録されている
- [ ] フォーマット: `youtube VIDEO_ID`

---

## ✅ 最終チェック

### ドキュメント確認
- [ ] `TESTING_GUIDE.md` の内容が実際の機能と一致している
- [ ] `OUTPUT_TEMPLATE_GUIDE.md` が参照可能
- [ ] `BUILD_WINDOWS.md` が最新

### コードの品質
- [ ] すべてのPythonファイルが構文エラーなし
- [ ] インポートエラーがない
- [ ] すべてのマネージャーが正しく初期化される

### パフォーマンス
- [ ] アプリ起動が5秒以内
- [ ] UI操作が即座に反応する
- [ ] ダウンロード中もUIがフリーズしない
- [ ] メモリリークがない（長時間使用）

---

## 📈 テスト結果サマリー

| 機能 | 状態 | 備考 |
|------|------|------|
| 1. 画質/フォーマット選択 | ⬜ |  |
| 2. 字幕ダウンロード | ⬜ |  |
| 3. 通知機能 | ⬜ |  |
| 4. プレイリスト一括DL | ⬜ |  |
| 5. 重複チェック | ⬜ |  |
| 6. サムネイルDL | ⬜ |  |
| 7. 速度制限 | ⬜ |  |
| 8. yt-dlp自動更新 | ⬜ |  |
| 9. プロキシ設定 | ⬜ |  |
| 10. ダウンロード履歴 | ⬜ |  |
| GUI統合テスト | ⬜ |  |
| 統合ダウンロードテスト | ⬜ |  |

### 発見された問題

| # | 機能 | 問題内容 | 重要度 | 状態 |
|---|------|----------|--------|------|
| 1 |  |  |  | ⬜ |
| 2 |  |  |  | ⬜ |
| 3 |  |  |  | ⬜ |

---

## 🎯 テスト完了基準

すべてのテストが ✅ になったら、以下が確認できます：

1. ✅ バックエンド実装が正しく動作している
2. ✅ GUI実装が完全である
3. ✅ すべての機能が統合されている
4. ✅ ユーザードキュメントが正確である
5. ✅ 本番環境へのデプロイ準備が完了している

---

**テスト実施者:** _________________

**テスト日:** _________________

**環境:**
- OS: _________________
- Python バージョン: _________________
- yt-dlp バージョン: _________________

**最終結果:** ✅ 合格 / ❌ 不合格 / 🔄 再テスト必要
